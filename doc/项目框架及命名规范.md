## 开发规范
### 目录结构
```
service/服务名
- client：服务内部和外部都直接调用的变量和函数，不允许引用任何其他非第三方包，也不允许调用任何rpc接口，仅做全局声明使用。
- api：web和客户端直接调用的接口层，一般用来鉴权和服务调用，其他所有文件不能引用api内的任何文件。
- rpc：处理业务逻辑的服务层，可调用任何rpc，也可被任何rpc调用。
- model：数据交互层，直接与数据库进行交互。
```
### api文档书写
api服务及内部的所有接口不允许其他任何服务直接调用
1. .api文件
   示例：https://go-zero.dev/docs/reference
   所有命名及格式问题参照：community/service/message
```
type (
    // 大驼峰定义请求体，结构为：服务名+行为+Req/Resp
	MessageUpdateByIdReq {
		MessageIds string   `json:"message_ids"`// 大驼峰定义名称，小驼峰定义json
	}
)
@server (
	group: message // 全小写命名
)
// 大驼峰命名，结构为：服务名
service Message {
    // 大驼峰命名，结构为：服务名+行为
  	@handler MessageUpdateById
  	// 下划线命名路径/服务/行为 
	post /message/update/id (MessageUpdateByIdReq) returns (MessageUpdateByIdResp)
}
```
2. config.go文件
```
type Config struct {
	rest.RestConf
	Auth struct {
		AccessSecret string
		AccessExpire int64
	}
	MessageConf       zrpc.RpcClientConf // 所有调用的rpc命名直接为{服务名{大驼峰}+Conf}
	WebSocketPushConf zrpc.RpcClientConf 
}
```
3. svc目录
- 目录结构
```
/svc
- setvicecontext.go 上下文定义
- rpcclient.go 所有的rpc定义
- modelclient.go 所有的中间件及数据库定义
```
- servicecontext.go
```
// servicecontext.go
type ServiceContext struct {
	Config    config.Config
	RpcClient *RpcClient // rpc客户端，固定格式命名
	ModelClient *ModelClient // 数据库客户端，固定格式命名
}
func NewServiceContext(c config.Config) *ServiceContext {
	return &ServiceContext{
		Config:    c,
		RpcClient: NewRpcClient(c),
		ModelClient: DefaultModelClient(),
	}
}
```
- rpcclient.go
```
type RpcClient struct {
	Message       message.Message // 驼峰命令，格式服务名，包名也必须为服务名小写，如果正确格式构建rpc，一定得到的是不重复的小写名
	WebSocketPush websocketpush.WebsocketPush // 驼峰命令，格式服务名
}

func NewRpcClient(c config.Config) *RpcClient {
	return &RpcClient{
		Message:       message.NewMessage(zrpc.MustNewClient(c.MessageConf)),
		WebSocketPush: websocketpush.NewWebsocketPush(zrpc.MustNewClient(c.WebSocketPushConf)),
	}
}
```
- modelclient.go
```
type ModelClient struct {
    // 对于唯一端，比如scylla，mysql等，通过表名来区分的直接写数据库名称
    // 对于多端，即需要参数来区分的，写数据库+表名
	Mysql user.UserModel
	MongoPost model.PostModel
}

func DefaultModelClient() *ModelClient {
	return &ModelClient{
		Mysql: user.NewUserModel(xmysql.GetMysqlCommunityClient()),
		MongoPost: model.NewCommunityModel("Post"),
	}
}

```
### rpc文档书写
1. .proto文件
```protobuf
syntax = "proto3";// 固定格式

package message; // 跟文件夹名

option go_package = "./";// 固定格式
service Message{// 大驼峰，根文件夹名
  rpc GetMessageByIds(GetMessageByIdsReq)returns (GetMessageByIdsResp);// 大驼峰，业务名，请求为：业务名+Req，返回为：业务名+Resp。
}

message MessageContent {// 大驼峰
  string text = 1;   // 下划线
  int64 message_type = 2;
  string addition = 3;
}

message MessageDetail {
  int64 message_id = 1;         // 消息唯一ID
  string session_id = 2;         // 会话ID（关联群聊或单聊）
  int64 send_id = 3;            // 发送者ID
  int64 reply_id = 4;           // 回复的消息ID（0表示非回复）
  int64 create_time = 5;        // 创建时间（毫秒级时间戳）
  int64 update_time = 6;        // 更新时间（编辑/撤回时更新）
  int64 status = 7;             // 消息状态
  MessageContent content = 8;   // 消息内容
}

message GetMessageByIdsReq{
  string session_id=1;
  repeated int64 message_id=2;
}

message GetMessageByIdsResp{
  repeated MessageDetail message_detail=1;
}
```
## 附件
### 附件一：命名方式
群聊创建
1. 下划线：chat_group_create
2. 小驼峰：chatGroupCreate
3. 大驼峰：ChatGroupCreate